

<!DOCTYPE html>
<html>
  <head>
    <title>
	監視 :: テックまとめ
</title>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="revised" content="2021-07-14T22:06:15 JST">
<meta name="description" content="備忘録用メモサイト">



<title>監視 :: テックまとめ</title>

<link rel="shortcut icon" href='/images/favicon.png' type="image/x-icon" />

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css">

<script src='https://code.jquery.com/jquery-3.5.1.min.js'></script>

<link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel="stylesheet">



<link rel="stylesheet" type="text/css" href='https://tanakakns.github.io/sass/layout.css'>
<link rel="stylesheet" type="text/css" href='https://tanakakns.github.io/css/style.main.css'>
<link rel="stylesheet" type="text/css" href='https://tanakakns.github.io/css/style.menu.css'>
<link rel="stylesheet" type="text/css" href='https://tanakakns.github.io/sass/shortcodes/notice.css'>
<link rel="stylesheet" type="text/css" href='https://tanakakns.github.io/sass/shortcodes/tabs.css'>
<link rel="stylesheet" type="text/css" href='https://tanakakns.github.io/sass/shortcodes/panel.css'>
<link rel="stylesheet" type="text/css" href='https://tanakakns.github.io/sass/shortcodes/columns.css'>
<link rel="stylesheet" type="text/css" href='https://tanakakns.github.io/sass/shortcodes/children.css'>
<link rel="stylesheet" type="text/css" href='https://tanakakns.github.io/sass/shortcodes/attachments.css'>
<link rel="stylesheet" type="text/css" href='https://tanakakns.github.io/sass/shortcodes/alert.css'>
<link rel="stylesheet" type="text/css" href='/css/docport.css'>

<script src='/js/docport.js'></script>
<script type="text/javascript">
      var baseurl = "https:\/\/tanakakns.github.io\/";
</script>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-42388425-3', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
  </head>

  <body data-url="/gcp/monitoring/"

  class="hidetoc hidenextpage ">

<style type="text/css">
  #debug{
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    line-height: 3.5rem;
    margin-bottom: .35rem;
    padding: 0 2rem;
    position: fixed;
    left: 0;      right: 0;     top: 0;
   
    top:0px;
    
    min-height: 150px;

    background-color: white;
    border: 3px solid red;
    z-index: 10000 ;
    word-wrap: all;
    overflow: auto;
  }
</style>
 


    
    
    <header style="">
        <div>
    
    <div class="burger ">
        <a href="javascript:void(0);" style="font-size:15px;" onclick="$('article > aside').toggleClass('responsive')">&#9776;</a>
    </div>
    

    <div>

		
	
			
		
	    	<a class='baselink' href='https://tanakakns.github.io/'>テックまとめ</a>
	  	
	</div>

</div>
    </header>
    

    <article>
      
      <aside class="">
        

		
	
			
		
	    	
	  	
	<div id="close_menu">
  <a href="javascript:void(0);" style="font-size:15px;" onclick="$('article > aside').toggleClass('responsive')">
      <i class="fa fa-lg fa-times"></i>
  </a>
</div>

<ul class="menu">

    <li data-nav-id="https://tanakakns.github.io/design/" class="dd-item haschildren
        item_level_$level
        ">

      
      
      
      <i class="fas fa-chevron-right ddexp"></i>
        
      
          <a href="/design/">設計</a>
      
        <ul>
              

    <li data-nav-id="https://tanakakns.github.io/design/architecture/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/design/architecture/">アーキテクチャ</a>
      
        
      
    </li>
        </ul>
    </li>
    

    <li data-nav-id="https://tanakakns.github.io/mac/" class="dd-item haschildren
        item_level_$level
        ">

      
      
      
      <i class="fas fa-chevron-right ddexp"></i>
        
      
          <a href="/mac/">Mac開発環境</a>
      
        <ul>
              

    <li data-nav-id="https://tanakakns.github.io/mac/os-settings/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/mac/os-settings/">OSの設定</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/mac/homebrew/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/mac/homebrew/">Homebrew</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/mac/asdf/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/mac/asdf/">asdf</a>
      
        
      
    </li>
        </ul>
    </li>
    

    <li data-nav-id="https://tanakakns.github.io/git/" class="dd-item haschildren
        item_level_$level
        ">

      
      
      
      <i class="fas fa-chevron-right ddexp"></i>
        
      
          <a href="/git/">Git</a>
      
        <ul>
              

    <li data-nav-id="https://tanakakns.github.io/git/initial-setting/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/git/initial-setting/">初期設定</a>
      
        
      
    </li>
        </ul>
    </li>
    

    <li data-nav-id="https://tanakakns.github.io/go/" class="dd-item haschildren
        item_level_$level
        ">

      
      
      
      <i class="fas fa-chevron-right ddexp"></i>
        
      
          <a href="/go/">Go言語</a>
      
        <ul>
              

    <li data-nav-id="https://tanakakns.github.io/go/initial-setting/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/go/initial-setting/">初期設定</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/go/grammar/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/go/grammar/">文法</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/go/naming/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/go/naming/">命名規則</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/go/pattern/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/go/pattern/">パターン</a>
      
        
      
    </li>
        </ul>
    </li>
    

    <li data-nav-id="https://tanakakns.github.io/database/" class="dd-item haschildren
        item_level_$level
        ">

      
      
      
      <i class="fas fa-chevron-right ddexp"></i>
        
      
          <a href="/database/">Database</a>
      
        <ul>
              

    <li data-nav-id="https://tanakakns.github.io/database/rdb/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/database/rdb/">RDB</a>
      
        
      
    </li>
        </ul>
    </li>
    

    <li data-nav-id="https://tanakakns.github.io/aws/" class="dd-item
        item_level_$level
        ">

      
      
      
      
        
      
          <a href="/aws/">AWS</a>
      
    </li>
    

    <li data-nav-id="https://tanakakns.github.io/gcp/" class="dd-item parent haschildren
        item_level_$level
        ">

      
      
      
      
          <i class="fas fa-chevron-down ddexp"></i>
        
      
          <a href="/gcp/">GCP</a>
      
        <ul>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/gcp-aws/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/gcp-aws/">GCP と AWS の比較</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/monitoring/" class="dd-item parent active
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/monitoring/">監視</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/tools/" class="dd-item haschildren
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/tools/">ツール</a>
      <i class="fas fa-chevron-right ddexp"></i>
        
      
        <ul>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/tools/management-tools/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/tools/management-tools/">管理ツール</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/tools/dev-tools/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/tools/dev-tools/">開発ツール</a>
      
        
      
    </li>
        </ul>
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/access-control-and-security/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/access-control-and-security/">アクセス制御とセキュリティ</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/computing-hosting/" class="dd-item haschildren
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/computing-hosting/">コンピューティングとホスティング</a>
      <i class="fas fa-chevron-right ddexp"></i>
        
      
        <ul>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/computing-hosting/compute-engine/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/computing-hosting/compute-engine/">Compute Engine</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/computing-hosting/kubernetes-engine/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/computing-hosting/kubernetes-engine/">Google Kubernetes Engine</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/computing-hosting/app-engine/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/computing-hosting/app-engine/">App Engine</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/computing-hosting/cloud-functions/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/computing-hosting/cloud-functions/">Cloud Functions</a>
      
        
      
    </li>
        </ul>
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/storage/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/storage/">ストレージ</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/databases/" class="dd-item haschildren
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/databases/">データベース</a>
      <i class="fas fa-chevron-right ddexp"></i>
        
      
        <ul>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/databases/bigquery/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/databases/bigquery/">BigQuery</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/databases/sql/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/databases/sql/">Cloud SQL</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/databases/memorystore/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/databases/memorystore/">Memorystore</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/databases/spanner/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/databases/spanner/">Cloud Spanner</a>
      
        
      
    </li>
        </ul>
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/networking/" class="dd-item haschildren
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/networking/">ネットワーキング</a>
      <i class="fas fa-chevron-right ddexp"></i>
        
      
        <ul>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/networking/vpc/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/networking/vpc/">VPC</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/networking/load-balancing/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/networking/load-balancing/">Cloud Load Balancing</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/networking/iap/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/networking/iap/">Identity-Aware Proxy</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/networking/interconnect/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/networking/interconnect/">Cloud Interconnect</a>
      
        
      
    </li>
        </ul>
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/big-data/" class="dd-item haschildren
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/big-data/">ビッグデータ</a>
      <i class="fas fa-chevron-right ddexp"></i>
        
      
        <ul>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/big-data/pubsub/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/big-data/pubsub/">Cloud Pub/Sub</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/big-data/dataflow/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/big-data/dataflow/">Dataflow</a>
      
        
      
    </li>
        </ul>
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/gcp/machine-learning/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/gcp/machine-learning/">機械学習</a>
      
        
      
    </li>
        </ul>
    </li>
    

    <li data-nav-id="https://tanakakns.github.io/terraform/" class="dd-item haschildren
        item_level_$level
        ">

      
      
      
      <i class="fas fa-chevron-right ddexp"></i>
        
      
          <a href="/terraform/">Terraform</a>
      
        <ul>
              

    <li data-nav-id="https://tanakakns.github.io/terraform/basic/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/terraform/basic/">入門</a>
      
        
      
    </li>
        </ul>
    </li>
    

    <li data-nav-id="https://tanakakns.github.io/docker/" class="dd-item haschildren
        item_level_$level
        ">

      
      
      
      <i class="fas fa-chevron-right ddexp"></i>
        
      
          <a href="/docker/">Docker</a>
      
        <ul>
              

    <li data-nav-id="https://tanakakns.github.io/docker/basic/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/docker/basic/">入門</a>
      
        
      
    </li>
        </ul>
    </li>
    

    <li data-nav-id="https://tanakakns.github.io/kubernetes/" class="dd-item haschildren
        item_level_$level
        ">

      
      
      
      <i class="fas fa-chevron-right ddexp"></i>
        
      
          <a href="/kubernetes/">Kubernetes</a>
      
        <ul>
              

    <li data-nav-id="https://tanakakns.github.io/kubernetes/concept/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/kubernetes/concept/">概念整理</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/kubernetes/architecture/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/kubernetes/architecture/">アーキテクチャ</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/kubernetes/kubectl-plugin/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/kubernetes/kubectl-plugin/">kubectl plugin と Krew</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/kubernetes/command/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/kubernetes/command/">コマンド</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/kubernetes/manifest/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/kubernetes/manifest/">マニフェスト</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/kubernetes/application-management/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/kubernetes/application-management/">アプリケーション管理</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/kubernetes/cluster-management/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/kubernetes/cluster-management/">クラスタ管理</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/kubernetes/security/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/kubernetes/security/">セキュリティ</a>
      
        
      
    </li>
        </ul>
    </li>
    

    <li data-nav-id="https://tanakakns.github.io/istio/" class="dd-item haschildren
        item_level_$level
        ">

      
      
      
      <i class="fas fa-chevron-right ddexp"></i>
        
      
          <a href="/istio/">Istio</a>
      
        <ul>
              

    <li data-nav-id="https://tanakakns.github.io/istio/basic/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/istio/basic/">入門</a>
      
        
      
    </li>
              

    <li data-nav-id="https://tanakakns.github.io/istio/concept/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/istio/concept/">概念整理</a>
      
        
      
    </li>
        </ul>
    </li>
    



</ul>

		
	
			
		
	    	
	  	
	
      </aside>
      

      <section class="page ">
      
	
		
    
    
    <nav id="ariane" aria-label="breadcrumb">
      <ol class="ariane">
        
  
  	
		
  
  	
	<li >
      <a class="text-link" href="https://tanakakns.github.io/">
        
      </a>
    </li>
	
  
    <li class="">
      <a class="text-link" href="/gcp/">
        GCP
      </a>
    </li>
	
  	
  
    <li class="active">
      
        監視
      
    </li>

      </ol>
    </nav>
    
    

    
		
        
		
		
		
		
		
		
		

		
			<h1>監視</h1>
        

		
										
		

		
	

	
	
	






	<div class="content">
	    <p>Cloud Logging、Cloud Monitoring、Cloud Trace、Debugger、Error Reporting</p>
<ol>
<li><a href="#1-%E3%82%B3%E3%83%B3%E3%82%BB%E3%83%97%E3%83%88">コンセプト</a></li>
<li><a href="#2-cloud-logging">Cloud Logging</a></li>
<li><a href="#3-cloud-monitoring">Cloud Monitoring</a></li>
</ol>
<h2 ref="1-コンセプト" >1. コンセプト</h2><a class="anchor" id="1-コンセプト"></a>
<p><a href="https://cloud.google.com/products/operations?hl=ja">オペレーションスイート</a>（旧称 Stackdriver）</p>
<ol>
<li><a href="https://cloud.google.com/logging/docs/concepts?hl=ja">Cloud Logging</a>
<ul>
<li>リアルタイムでログを収集・分析する大規模なフルマネージドサービス
<ul>
<li>フィルターや検索でログ分析でき、トラブルシューティングが加速</li>
<li>ログに基づいた指標（メトリクス）定義</li>
<li>VM インスタンスに対しては<a href="https://cloud.google.com/logging/docs/agent?hl=ja">Logging エージェント</a>を導入する必要がある（ GKE ノードはデフォルトで導入済）</li>
<li>ログは <strong>400 日間</strong> 保存されるが延長することはできないので、長期保存するには Cloud Storage などへエキスポートする必要がある</li>
</ul>
</li>
<li>アプリケーションとシステムのログデータのほか、GKE 環境 や Google Cloud サービスからのカスタム ログデータも取り込める</li>
<li>BigQuery、Google Cloud Storage、Pub/Subへのエクスポートできる</li>
</ul>
</li>
<li><a href="https://cloud.google.com/monitoring/docs/concepts?hl=ja">Cloud Monitoring</a>
<ul>
<li>組み込みの大規模なリソース指標（メトリクス）オブザーバビリティ</li>
<li>クラウドで実行されるアプリケーションのパフォーマンスや稼働時間、全体的な動作状況を確認できる</li>
<li>メトリクス・イベント・メタデータを収集し、<strong>ワークスペース</strong> を作成することでチャートやダッシュボードで可視化してアラート管理できる</li>
<li>AWS にも対応</li>
</ul>
</li>
<li><a href="https://cloud.google.com/trace/docs/overview">Cloud Trace</a>
<ul>
<li>各プログラミング言語に対応したライブラリを使用することで、HTTP ヘッダを挿入し、VM、コンテナー、AppEngine、トレースをキャプチャする
<ul>
<li>ロードバランサにも対応</li>
</ul>
</li>
<li>URL ごとの統計、レイテンシの分布</li>
</ul>
</li>
<li>Cloud Debugger
<ul>
<li>本番環境でのコードのデバッグ（途中で止める）</li>
<li>デバッグのスナップショットを取得する（コード内の特定の場所で、アプリのローカル変数とコールスタックの状態を確認できます）</li>
<li>コードにログポイントを追加する（再起動したり通常の機能を妨げたりせずに、実行中のサービスにロギングを挿入できます）</li>
</ul>
</li>
<li>Cloud Profiler
<ul>
<li>本番環境のアプリケーションのリソース消費を継続的にプロファイリング</li>
<li>実行中のサービスの解析を行うために使用</li>
</ul>
</li>
<li>Cloud Error Reporting
<ul>
<li>エラーをレポート、通知</li>
</ul>
</li>
</ol>
<ul>
<li>エージェント
<ul>
<li>インスタンスから情報を収集する VM に <a href="https://cloud.google.com/monitoring/agent">Monitoring エージェント</a> と <a href="https://cloud.google.com/logging/docs/agent?hl=ja">Logging エージェント</a> をインストールすることで収集可能となる</li>
</ul>
</li>
</ul>
<h2 ref="2-cloud-logging" >2. Cloud Logging</h2><a class="anchor" id="2-cloud-logging"></a>
<h3 ref="21-アクセス制御" >2.1. アクセス制御</h3><a class="anchor" id="21-アクセス制御"></a>
<p>IAM を使用して Google Cloud リソースのロギングデータへの <a href="https://cloud.google.com/logging/docs/access-control?hl=ja#permissions_and_roles">アクセス制御</a> を実施できる。</p>
<ul>
<li><code>roles/logging.viewer</code>（ログビューア）（＝ <code>roles/viewer</code> ）
<ul>
<li>アクセスの透明性ログとデータアクセス監査ログ以外のすべての Logging 機能に対する読み取り専用権限</li>
</ul>
</li>
<li><code>roles/logging.privateLogViewer</code>（プライベート ログビューア）
<ul>
<li><code>roles/logging.viewer</code> に加え、アクセスの透明性ログとデータアクセス監査ログの読み取り権限</li>
<li>このロールは、_Required バケットと _Default バケットにのみ適用される</li>
</ul>
</li>
<li><code>roles/logging.logWriter</code>（ログ書き込み）
<ul>
<li>サービスアカウントに付与して、ログの書き込みに十分な権限のみをアプリケーションに付与できる</li>
<li>ただし、閲覧権限はない</li>
</ul>
</li>
<li><code>roles/logging.bucketWriter</code>（ログバケット書き込み）
<ul>
<li>サービス アカウントに付与すると、ログバケットにログを書き込むための十分な権限を Cloud Logging に付与できる</li>
<li>このロールを特定のバケットに制限するには、IAM 条件を使用する</li>
</ul>
</li>
<li><code>roles/logging.configWriter</code>（ログ構成書き込み）は
<ul>
<li>ログベースの指標、除外、バケット、ビューを作成し、シンクをエクスポートする権限</li>
<li>これらのアクションに Logs Explorer（コンソール）を使用するには、 <code>roles/logging.viewer</code> を追加する</li>
</ul>
</li>
<li><code>roles/logging.admin</code>（Logging 管理者）
<ul>
<li>Logging に関連するすべての権限</li>
</ul>
</li>
<li><code>roles/logging.viewAccessor</code>（ログ表示アクセス者）
<ul>
<li>ビュー内のログを読み取るための権限</li>
<li>このロールを特定のバケット内のビューに制限するには、IAM 条件を使用</li>
</ul>
</li>
<li><code>roles/editor</code>（プロジェクト編集者）
<ul>
<li>roles/logging.viewer の権限、ログエントリの書き込み権限、ログの削除権限、ログベースの指標の作成権限が含まれる</li>
<li>この役割では、エクスポート シンクの作成や、アクセスの透明性ログまたはデータアクセス監査ログの読み取りを行うことはできない</li>
</ul>
</li>
<li><code>roles/owner</code>（プロジェクト オーナー）
<ul>
<li>Logging に対する完全アクセス権（アクセスの透明性ログとデータアクセス監査ログ）</li>
</ul>
</li>
</ul>
<h3 ref="21-ログの種類" >2.1. ログの種類</h3><a class="anchor" id="21-ログの種類"></a>
<ul>
<li>Google Cloud Platform のログ： GCP サービス固定ログ</li>
<li>ユーザー作成のログ：ユーザ独自ログで、Logging エージェント、Cloud Logging API、または Cloud Logging クライアント ライブラリから取り込んだもの</li>
<li>セキュリティログ
<ul>
<li>監査ログ（<a href="https://cloud.google.com/logging/docs/audit">Cloud Audit Logs</a>）</li>
<li><a href="https://cloud.google.com/logging/docs/audit/access-transparency-overview">アクセスの透過ログ</a>： Google スタッフによる操作ログ</li>
</ul>
</li>
<li>マルチクラウドとハイブリッド クラウドのログ： Azure や AWS など別クラウドから取り込んだログ</li>
</ul>
<h4 ref="211-監査ログ" >2.1.1. 監査ログ</h4><a class="anchor" id="211-監査ログ"></a>
<p>権限管理された上で、オペレーションを監視するログに以下の種類がある。（ <a href="https://cloud.google.com/logging/docs/audit">Cloud Audit Logs</a> ）</p>
<ul>
<li>管理アクティビティ監査ログ
<ul>
<li>リソース構成やメタデータ変更オペレーションが記録される</li>
<li>デフォルトで有効で無効にできない</li>
</ul>
</li>
<li>データアクセス監査ログ
<ul>
<li>リソース構成やメタデータ読み取り API 操作が記録される</li>
<li>デフォルトは無効</li>
</ul>
</li>
<li>システムイベント監査ログ
<ul>
<li>Google システムによって生成される管理アクション</li>
</ul>
</li>
<li>ポリシー拒否監査ログ
<ul>
<li>セキュリティ ポリシー違反のため Google Cloud サービスがユーザーまたはサービス アカウントへのアクセスを拒否したときに、ポリシー拒否監査ログを記録する</li>
</ul>
</li>
</ul>
<p>現状、アクティビティログというサービスがあるが、 Deprecated なので監査ログを使用すること。</p>
<h3 ref="22-エキスポートシンク" >2.2. エキスポート・シンク</h3><a class="anchor" id="22-エキスポートシンク"></a>
<p>Cloud Logging は以下のエキスポート・シンクをサポートする。<br>
gcloud 、Cloud Console、Google Cloud APIs ログシンクでログシンクのエクスポート先を作成してから、<a href="https://cloud.google.com/logging/docs/export/aggregated_sinks">集約シンク</a> を作成する。</p>
<ul>
<li>Cloud Storage
<ul>
<li>Cloud Storage バケットに保存される JSON ファイル</li>
</ul>
</li>
<li>BigQuery
<ul>
<li>BigQuery データセットに作成されるテーブ。</li>
</ul>
</li>
<li>Pub/Sub
<ul>
<li>Pub/Sub トピックに配信される JSON メッセージ</li>
<li>サードパーティによる Logging との統合サービス（Splunk など）をサポート</li>
</ul>
</li>
</ul>
<h2 ref="3-cloud-monitoring" >3. Cloud Monitoring</h2><a class="anchor" id="3-cloud-monitoring"></a>
<ul>
<li><a href="https://cloud.google.com/monitoring/workspaces?hl=ja#accounts">ワークスペース</a> は、1 つ以上の Google Cloud プロジェクトまたは AWS アカウントに含まれるリソースをモニタリングするためのツール
<ul>
<li>各ワークスペースには、Google Cloud プロジェクトや AWS アカウントなど、1～100 個のモニタリング対象プロジェクトを作成できる</li>
<li>ワークスペースの数に制限はないが、Google CloudプロジェクトとAWSアカウントを複数のワークスペースでモニタリングすることはできない</li>
</ul>
</li>
<li><strong>ホストプロジェクト</strong>
<ul>
<li>すべてのワークスペースには、ホストプロジェクトがある</li>
<li>ワークスペースの作成に使用した Google Cloud プロジェクトが、ワークスペースのホスト プロジェクト</li>
</ul>
</li>
<li>モニタリング対象プロジェクト
<ul>
<li>ホストプロジェクトでワークスペースを作成すると、Google Cloud プロジェクトと AWS アカウントが追加できるようになる</li>
<li>新しい空白の Google Cloud プロジェクトを使用してワークスペースをホストしてから、モニタリングするプロジェクトと AWS アカウントをワークスペースに追加するのがよい
<ul>
<li>ホスト プロジェクトと Workspace の名前を自由に選択でき、ワークスペース間でモニタリング対象プロジェクトを柔軟に移動できる</li>
</ul>
</li>
</ul>
</li>
<li><a href="https://cloud.google.com/monitoring/custom-metrics">カスタムメトリクス</a></li>
</ul>
<h3 ref="31-metrics-explorer" >3.1. Metrics Explorer</h3><a class="anchor" id="31-metrics-explorer"></a>
<p><a href="https://cloud.google.com/monitoring/charts/metrics-explorer?hl=ja">Metrics Explorer</a> を使用すると、プロジェクトで収集された指標のグラフを作成できる。</p>
<h3 ref="32-アラート" >3.2. アラート</h3><a class="anchor" id="32-アラート"></a>
<p><a href="https://cloud.google.com/monitoring/alerts/concepts-indepth">アラートの動作</a></p>
<h3 ref="33-プラグイン" >3.3. プラグイン</h3><a class="anchor" id="33-プラグイン"></a>
<p>オンプレミスや Compute Engine にインストールしたサードパーティ製アプリケーションをモニタリングする際のプラグインとして以下のようなものがある。</p>
<ul>
<li>Apache</li>
<li>JMX Monitoring</li>
<li>Memcached</li>
<li>MySQL ： プラグインを導入するだけではダメで、 MySQL に接続するユーザの作成と設定が必要</li>
<li>Nginx</li>
<li>Redis</li>
<li>StatsD</li>
</ul>
		</div>






	
	

      </section>

      
      
    </article>
    
    
    <footer>
      

		
	
			
		
	    	
	  	
	
    </footer>
    



  </body>
</html>
